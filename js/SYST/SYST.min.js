(function(e){"use strict";var t=this,e={};e="undefined"!=typeof exports?exports:t.SYST={},e.version="0.0.4",e.author="Rodey Luo",e.name="SYST JS MVC mini Framework (JS MVC框架)",e.noConflict=function(){return t.SYST=e,this};try{e.$=t.jQuery||t.Zepto||t.ender||void 0}catch(n){throw new Error("$不存在，请先引入jQuery|Zepto|Ender插件，依赖其中一个。"+n)}try{e.template=t.template||t._||void 0}catch(n){throw new Error("模板解析对象不存在，请先引入arttemplate|underscore插件，依赖其中一个"+n)}var r=function(e,t){if(!e)return t;if(!t)return e;if(!t.prototype){t.__super__=e;var n;for(n in e)e.hasOwnProperty(n)&&(t[n]=e[n])}return t},o=function(e){var t,n=e,r={};for(t in n)n.hasOwnProperty(t)&&(r[t]=n[t]);return r},i=function(e,t){var n=[];e=e||window;for(var r=2;r<arguments.length;r++)n.push(arguments[r]);return function(r){if(r&&"object"==typeof r&&(r.preventDefault(),r.stopPropagation()),n.push(r),!e[t])throw new Error(t+" 函数未定义！");e[t].call(e,r,n)}};e.extend=r,e.clone=o,e.hoadEvent=i;e.Model=function(t){return this.__Name__="Model",t?(t=t||{},t.__SuperName__="SYST Model",t=r(e.Model.prototype,t),t._initialize(),t):new e.Model({})};e.Model.prototype={_initialize:function(){this.init&&this.init.apply(this,arguments),this.attributes={},e.shareModel.add(this)},get:function(e,t){return this.attributes[e]},set:function(e,t,n){if(null==e)return this;if(e)if("object"==typeof e)for(var r in e)this.attributes[r]=e[r];else{if(!("string"==typeof e&&e.length>0))return this;this.attributes[e]=t}},getItem:function(e,t){var n=(t?window.sessionStorage:window.localStorage).getItem(e);try{n=JSON.parse(n)}catch(r){}return n},setItem:function(t,n,r){function o(t,n){e.V.isObject(n)&&(n=JSON.stringify(n)),(r?window.sessionStorage:window.localStorage).setItem(t,n)}if(e.V.isObject(t))for(var i in t)o(i,t[i]);else{if(!("string"==typeof t&&t.length>0))return this;o(t,n)}},has:function(e){return Boolean(this.attributes[e])},hasItem:function(e,t){return Boolean((t?window.sessionStorage:window.localStorage).getItem(e))},add:function(e,t,n){this.set(e,t,n)},remove:function(e){return e&&""!=e?(this.attributes[e]=null,void delete this.attributes[e]):this},removeItem:function(e,t){(t?window.sessionStorage:window.localStorage).removeItem(e)},removeAll:function(e){e?this.attributes=[]:function(){window.localStorage.clear(),window.sessionStorage.clear()}()},_getName:function(){return this.__Name__},doRequest:function(n,o,i,a,s){var u,l,c=this,f={};if(o&&"object"==typeof o&&n&&""!=n){s?(u=s.type,l=s.dataType||c.ajaxDataType||"json",f=s):(u=c.ajaxType||"POST",l=c.ajaxDataType||"json"),c.ajaxBefore&&e.V.isFunction(c.ajaxBefore)&&(f.beforeSend=c.ajaxBefore.apply(c));var d=r(f,{url:n,type:u,data:o,dataType:l,success:function(t){c.ajaxSuccess&&e.V.isFunction(c.ajaxSuccess)&&c.ajaxSuccess.call(c,t),i&&e.V.isFunction(i)&&i.call(c,t)},error:function(t,n){var r=t.response;try{r=JSON.parse(r)}catch(o){}c.ajaxError&&e.V.isFunction(c.ajaxError)&&c.ajaxError.call(c,r,t,n),a&&e.V.isFunction(a)&&a.call(c,r,t,n)},complete:function(t){c.ajaxComplete&&e.V.isFunction(c.ajaxComplete)&&c.ajaxComplete.call(c,t)}});if(!t.$)throw new Error("doRequest: $不存在，此方法依赖于(jQuery||Zepto||Ender)");t.$.ajax(d)}},doAjax:function(e,t,n,r,o){this.doRequest(e,t,n,r,o)}},e._shareModels=[];e.shareModel={add:function(t){e._shareModels.push(t)},get:function(t){if(null==t)return e._shareModels;for(var n=0;n<e._shareModels.length;++n)if(t==e._shareModels[n])return e._shareModels[n];return null},remove:function(t){return e.T.arrRemove(e._shareModels,t),e._shareModels},has:function(t){return-1!==e.T.indexOf(e._shareModels,t)}},e.Controller=function(t){return this.__Name__="Controller",this.model=void 0,this.superView=void 0,this.shareModels=e.shareModel.get(null),t?(t.__SuperName__="SYST Controller",t=r(e.Controller.prototype,t),t._initialize(),t):new e.Controller({})};e.Controller.prototype={defaultHost:location.host,shareModel:e.shareModel,_initialize:function(){this.init&&this.init.apply(this,arguments)},getModel:function(e){return e?this.shareModel.get(e):this.model},setModel:function(e){if(""!==key||null!=e)this.shareModel.add(e);else{if("object"!=typeof key)throw"setModel: 参数有误";this.model=key}}};e.Events=function(e,t,n,r,o,a){var o=o||"on",s="abort reset click dblclick tap touchstart touchmove touchend change mouseover mouseout mouseup mousedown mousemove mousewheel drag dragend dragenter dragleave dragover dragstart drop resize scroll submit select keydown keyup keypress touchstart touchend load unload blur focus contextmenu formchange forminput input invalid afterprint beforeprint beforeonload haschange message offline online pagehide pageshow popstate redo storage undo canplay canplaythrough durationchange emptied ended loadeddata loadedmetadata loadstart pause play playing progress ratechange readystatechange seeked seeking stalled suspend timeupdate volumechange waiting cut copy paste".split(/\s+/gi);e||(e=window);for(var u=0;u<s.length;u++)s[u]===n&&("window"==e.selector?"on"==o?$(window).off().on(n,i(t,r)):$(window).off(n,i(t,r)):"document"==e.selector||"html"==e.selector||"body"==e.selector?"on"==o?$(e.selector).off().on(n,i(t,r)):$(e.selector).off(n,i(t,r)):"on"==o?$(a||"body").undelegate(e.selector,n,i(t,r)).delegate(e.selector,n,i(t,r)):$(a||"body").undelegate(e.selector,n,i(t,r)))},e.View=function(t){return this.__Name__="View",t?(t.__SuperName__="SYST View",t=r(e.View.prototype,t),!t.unInit&&t._initialize(),t):new e.View({})};e.View.prototype={$el:{},tagPanel:"selection",_initialize:function(){var t=this;if(this.model=this.model?this.model:this.controller?this.controller.getModel():void 0,this.init&&this.init.apply(this,arguments),this.render){var n="<"+t.tagPanel+"/>";t.$el=e.$?e.$(n):t.parseDom("",n),t.render.apply(t,arguments)}this.events&&this.events!={}&&e.V.isObject(this.events)&&this.onEvent()},destroy:function(){this.$el.remove()},handEvent:function(e,t){for(var n=this,r=[],o=2;o<arguments.length;o++)r.push(arguments[o]);return function(o){r.push(t),r.push(o),e.apply(n,r)}},hoadEvent:i,parseEvent:function(t){function n(e,t,n){o.push(e),r.push(t),i.push(n)}if(!t||0==t.length||t==={})return this;var r=[],o=[],i=[];for(var a in t){var s=t[a];if(e.V.isObject(s))for(var u in s){var l=this.parseString(s,u),c=l[0],f=l[1],d=l[2];n(c,f,d)}else{var l=this.parseString(t,a),c=l[0],f=l[1],d=l[2];n(c,f,d)}}return{events:r,elements:o,functions:i}},autoHandleEvent:function(t){var n=this.parseEvent(this.events),r=n.events,o=n.elements,i=n.functions;if(!r||0==r.length||r.length=={})return this;for(var t=t||"on",a=0,s=r.length;s>a;a++){if(!r[a])throw new Error("对象侦听"+r[a]+"不存在");if(!i[a])throw new Error("对象"+this+"不存在"+i[a]+"方法");if(!o[a])throw new Error("事件函数"+i[a]+"不存在");e.Events($(o[a]),this,r[a],i[a],t,this.triggerContainer||"body")}return this},parseString:function(e,t){var n=$.trim(t).split(/\s+/gi),r=n[1].replace(/^\$*|[\(*]|[\)*]$/gi,"").replace(/"|'/gi,'"'),o=n[0].replace(/^\s*|\s*$/gi,""),i=e[t];return[r,o,i]},onEvent:function(){this.autoHandleEvent("on")},offEvent:function(){this.autoHandleEvent("off")},template:function(n,r){var o,i;return t.template?(i=e.template.compile(n),o=i(r)):o=t._?_.template(n,r):e.Render(n,r)},parseDom:function(t,n){return e.T.template(t,n)},getController:function(){return this.controller},getModel:function(){return this.model||this.getController().getModel()},shareModel:e.shareModels},e.tplConfig={open:"<%",close:"%>"};var a=/^\s*|\s*$/i,s=/(^( )?(if|for|else|switch|case|break|{|}))(.*)?/g,u=function(t,n){for(var r,o=0,i=e.tplConfig,a=new RegExp(i.open+"([^"+i.close+"]+)?"+i.close,"g"),u="var r = [];\n",l=function(e,t){return u+=t?e.match(s)?e+"\n":"r.push("+e+");\n":""!=e?'r.push("'+e.replace(/"/g,'\\"')+'");\n':"",l};r=a.exec(t);)l(t.slice(o,r.index))(r[1],!0),o=r.index+r[0].length;return l(t.substr(o,t.length-o)),u+='return r.join("");',new Function(u.replace(/[\r\t\n]/g,"")).apply(n)};e.Render=function(e,t){var n=document.querySelector("#"+e.replace("#")),r="";if(n){var o=/^(TEXTEREA|INPUT)$/i.test(n.nodeName)?n.value:n.innerHTML;r=o.replace(a,"")}else r=e.replace(a,"");try{this.cache=u(r,t)}catch(i){delete this.cache}return this.cache?this.cache:u(r,t)};e.Validate=function(t){return this.__Name__="Validate",t?(t.__SuperName__="SYST Validate",t=r(e.Validate.prototype,t)):new e.Validate({})};e.V=e.Validate.prototype={isEmpty:function(e){return e&&0!==e.length&&""!==e&&null!=e?!1:!0},isSet:function(e){return"undefined"!=typeof e?!0:!1},between:function(e,t,n,r){return r=r||!1,r?e.length>=t&&e.length<=n?!0:!1:e.length>t&&e.length<n?!0:!1},isCN:function(e,t){return t?/^[\u4e00-\u9fa5]+$/.test(e):/[\u4e00-\u9fa5]+/gi.test(e)},isEmail:function(e){return/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/gi.test(e)},isURL:function(e){return/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/i.test(e)},isTel:function(e){return/^(\(\d{3,4}\)|\d{3,4}-)?\d{7,8}$/gi.test(e)},isMobile:function(e){return/^1[3|4|5|7|8]{1}\d{9}$/.test(e)},isZip:function(e){return/^\d{6}$/.test(e)},isDateLocal:function(e){return/^(\d{4})-(\d{1,2})-(\d{1,2})$/.test(e)},isDateTime:function(e){return/^(\d{4})-(\d{1,2})-(\d{1,2})\s+(\d{1,2}):(\d{1,2}):(\d{1,2})$/.test(e)},isTime:function(e){return/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/.test(e)},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isArray:function(e){return"[object Array]"===toString.call(e)},isDate:function(e){return"[object Date]"===toString.call(e)},isObject:function(e){return null!=e&&"object"==typeof e},isFunction:function(e){return"function"==typeof e},isFile:function(e){return"[object File]"===toString.call(e)},isBlob:function(e){return"[object Blob]"===toString.call(e)},isBoolean:function(e){return"boolean"==typeof e},isdefined:function(e){return"undefined"!=typeof e},isRegExp:function(e){return"[object RegExp]"===toString.call(e)},isWindow:function(e){return e&&e.document&&e.location&&e.alert&&e.setInterval},isElement:function(e){return!(!e||!(e.nodeName||e.prop&&e.attr&&e.find))}};e.Tools=function(t){return this.__Name__="Tools",t?(t.__SuperName__="SYST Tools",t=r(e.Tools.prototype,t)):new e.Tools({})};e.T=e.Tools.prototype={template:function(e,t){var n=document.createElement(t||"div");return n.innerHTML=e,$?($(n).html(e),$(n)[0]):n.childNodes},trigger:function(e,t,n,r){if(e&&t&&""!==t)try{e[method].call(e,n,arguments),"function"==typeof r&&r.call(e,n)}catch(o){throw new Error(e+"不存在"+t+"方法 <::>")}},trim:function(e){return e.replace(/^\s*|\s*$/gi,"")},rtrim:function(e,t,n){if(t){var r;return r=n?new RegExp("\\"+t+"*","gi"):new RegExp("^(\\"+t+")*|(\\"+t+")*$","gi"),e.replace(r,"")}return this.trim(e)},indexOf:function(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0;n<e.length;n++)if(t===e[n])return n;return-1},arrRemove:function(e,t){var n=this.indexOf(e,t);return n>=0&&e.splice(n,1),t},F2C:function(e){for(var t="",e=e.replace(/\s*/gi,""),n=0;n<e.length;n++){var r=e.charCodeAt(n);t+=12288!=r?r>65280&&65375>r?String.fromCharCode(r-65248):String.fromCharCode(r):String.fromCharCode(32)}return t=t.replace(/\s*/gi,""),t.toUpperCase()},dateFm:function(e){return 10>e?"0"+e:e},setDateFormat:function(t,n,r){function o(e,t){t.push(r?i.dateFm(e):e)}if(e.V.isEmpty(t))return"";var i=this,a=new Date(parseInt(t,10)),s=[],u=[];if(!n)return a.getFullYear()+"-"+this.dateFm(a.getMonth()+1)+"-"+this.dateFm(a.getDate())+" "+this.dateFm(a.getHours())+":"+this.dateFm(a.getMinutes())+":"+this.dateFm(a.getSeconds());var l=n.match(/[^\w\d\s]+?/i),c=l[0]||"-",f=l[1]||":";return/y+?/i.test(n)&&o(a.getFullYear(),s),/m+?/i.test(n)&&o(a.getMonth()+1,s),/d+?/i.test(n)&&o(a.getDate(),s),/h+?/i.test(n)&&o(a.getHours(),u),/i+?/i.test(n)&&o(a.getMinutes(),u),/s+?/i.test(n)&&o(a.getSeconds(),u),e.T.trim(s.join(c)+(u.length>0?" "+u.join(f):""))},daysBetween:function(e,t,n){var r=e.substring(5,e.lastIndexOf("-")),o=e.substring(e.length,e.lastIndexOf("-")+1),i=e.substring(0,e.indexOf("-")),a=t.substring(5,t.lastIndexOf("-")),s=t.substring(t.length,t.lastIndexOf("-")+1),u=t.substring(0,t.indexOf("-")),l=(Date.parse(r+"/"+o+"/"+i)-Date.parse(a+"/"+s+"/"+u))/864e5;return n&&"function"==typeof n?void n(l):l},params:function(e){if(this._pars&&this._pars[e])return this._pars[e];var t=location.search||location.href.split("?")[1];if(!t)return{};t&&-1!==t.indexOf("?")&&(t=t.replace(/^\?/,""));var n=t.split("&");if(!n||[]===n)return null;for(var r=0,o=n.length,i={};o>r;++r){var a=n[r].split("=");a[0]&&""!==a[0]&&Object.defineProperty(i,a[0],{value:decodeURI(a[1])||null,writable:!0,enumerable:!0,configurable:!0})}return this._pars=i,e?decodeURI(i[e]):i},getParams:function(e){var t=new RegExp("(^|&)"+e+"=([^&]*)(&|$)","i"),n=window.location.search.substr(1).match(t);return n?decodeURI(n[2]):null},paramData:function(e,t){var n=e,r="";for(var o in n)r+="&"+o+"="+n[o];return r=r.substr(1),t===!0?"?"+r:r},Cookie:function(e,t,n){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(t))||null===t||void 0===t)){if(n=n||{},(null===t||void 0===t)&&(n.expires=-1),"number"==typeof n.expires){var r=n.expires,o=n.expires=new Date;o.setDate(o.getDate()+r)}return t=String(t),document.cookie=[encodeURIComponent(e),"=",n.raw?t:encodeURIComponent(t),n.expires?"; expires="+n.expires.toUTCString():"",n.path?"; path="+n.path:"",n.domain?"; domain="+n.domain:"",n.secure?"; secure":""].join("")}n=t||{};for(var i,a=n.raw?function(e){return e}:decodeURIComponent,s=document.cookie.split("; "),u=0;i=s[u]&&s[u].split("=");u++)if(a(i[0])===e)return a(i[1]||"");return null}};var l=navigator.userAgent.toUpperCase(),c=-1!==l.indexOf("ANDROID"),f=-1!==l.indexOf("IPHONE OS"),d=c||f?!0:!1,h=-1!==l.indexOf("MOBILE"),p=-1!==l.indexOf("IPAD"),g=h||p?!0:!1;e.Native=function(t){return this.__Name__="Native",t?(t.__SuperName__="SYST Native",t=r(e.Native.prototype,t)):new e.Native({})};e.N=e.Native.prototype={isAndroid:c,isIos:f,isNative:d,isPhone:h,isPad:p,isMobile:g,callNative:function(e){}};var m=(e.Router=function(t){return this.__Name__="Router",t?(t.__SuperName__="SYST Router",t=r(e.Router.prototype,t)):new e.Router({})},t.location),v=m.host,w=(m.port,m.origin||m.protocol+"//"+v,m.pathname,m.hash),y=function(e){return e.replace(/[#!]/gi,"").split("?")[0]};e.R=e.Router.prototype={_cache:{},start:function(){if(this.params=e.T.params(),w&&""!==w){var t=y(w);this._exec(t)}return this._change(),this},when:function(e,t){this._cache[e]=t},"switch":function(t){if(this._cache&&{}!==this._cache)return this.params=e.T.params(),this._exec(t),this},_exec:function(e){this._execRouter(e)},_execRouter:function(e){var t=this,n=this._cache[e];n&&(n.template?this._template(n.template,n.container,function(e){console.log(this),t._execMAction(n,e)}):t._execMAction(n))},_execMAction:function(t,n){this.tpl=n;var o={model:t.model,tpl:n,params:self.params,router:this},i={model:t.model,tpl:n,params:self.params,router:this,view:t.view};t.model&&function(){return e.Model(t.model)}(),t.view&&function(){return e.View(r(t.view,o))}(),t.controller&&function(){return e.Controller(r(t.controller,i))}(),t.action&&e.V.isFunction(t.action)&&t.action.call(this,t.model,n)},_change:function(){function e(e){t.oldURL="#"+e.oldURL.split("#")[1],t.newURL="#"+e.newURL.split("#")[1];var n=y(t.newURL);t["switch"](n)}var t=this;window.removeEventListener("hashchange",e,!1),window.addEventListener("hashchange",e,!1)},_template:function(t,n,r){var o=this,i=$("#"+n.replace(/#/gi,""));/<|>/.test(t)?i.html(t):i.load(t,function(t){r&&e.V.isFunction(r)&&r.call(o,t)},function(e){throw new Error("load template is failed!")})}},"function"==typeof define?define(function(){return e}):"undefined"!=typeof exports&&(module.exports=e),t.SYST=e}).call(this);