/**
 * Created with JetBrains WebStorm.
 * User: EX-LUOYONG002 （Rodey -- www.senuu.com）
 * 此框架依赖于: jQuery || Zepto || Ender   依赖于模板插件: Arttemplate || Underscore
 * 使用前请先引入依赖插件
 *
 * requireJS 引入:
 *                  'SYST' : {
                        deps : ['jQuery', 'arttemplate'],
                        exports: 'SYST'
                    }
 */

(function(SYST){var root=this;var SYST={};(typeof exports!=="undefined")?(SYST=exports):(SYST=root.SYST={});SYST.version="0.3.2";SYST.author="Rodey Luo";SYST.createDate="2014-07-01";SYST.name="SYST JS MVC Framework (JS MVC框架)";var ua=navigator.userAgent.toUpperCase();SYST.IS_ANDROID=ua.indexOf("ANDROID")!=-1;SYST.IS_IOS=ua.indexOf("IPHONE OS")!=-1;SYST.IS_NATIVE=(SYST.IS_ANDROID||SYST.IS_IOS)?true:false;SYST.noConflict=function(){root.SYST=SYST;return this};try{SYST.$=root.jQuery||root.Zepto||root.ender||undefined}catch(e){throw new Error("$不存在，请先引入jQuery|Zepto|Ender插件，依赖其中一个。"+e)}try{SYST.template=root.template||root._||undefined}catch(e){throw new Error("模板解析对象不存在，请先引入arttemplate|underscore插件，依赖其中一个。"+e)}SYST._extend=function(parent,child){if(!parent){return child}if(!child){return parent}if(!child.prototype){child.__super__=parent.prototype;for(var proto in parent.prototype){if(!parent.hasOwnProperty(proto)){child[proto]=parent.prototype[proto]}}}return child};var Model=SYST.Model=function(child){this.__Name__="Model";if(child){child=child||{};child.__SuperName__="SYST Model";child=SYST._extend(SYST.Model,child);child._initialize();return child}else{return new SYST.Model({})}};SYST.Model.prototype={_initialize:function(){this.init&&this.init.apply(this,arguments);this.attributes={}},get:function(key,options){return this.attributes[key]},set:function(key,value,options){if(key==null){return this}var attrs,options;if(key){if(typeof key==="object"){for(var k in key){this.attributes[k]=key[k]}}else{if(typeof key==="string"&&key.length>0){this.attributes[key]=value}else{return this}}}},getItem:function(key){return window.localStorage.getItem(key)},setItem:function(key,value,options){if(typeof key==="object"){for(var k in key){window.localStorage.setItem(k,key[k])}}else{if(typeof key==="string"&&key.length>0){if(SYST.V.isObject(value)){window.localStorage.setItem(key,JSON.stringify(value))}else{window.localStorage.setItem(key,value)}}else{return this}}},has:function(key){return Boolean(this.attributes[key])},hasItem:function(key){return Boolean(window.localStorage.getItem(key))},add:function(key,value,options){this.set(key,value,options)},remove:function(key){if(!key||key==""){return this}this.attributes[key]=null;delete this.attributes[key]},removeItem:function(key){window.localStorage.removeItem(key)},removeAll:function(flag){flag?(this.attributes=[]):window.localStorage.clear()},_getName:function(){return this.__Name__},doRequest:function(url,postData,su,fail,options){if(!postData||typeof postData!=="object"||!url||url==""){return}var su=options&&options.success?options.success:su;var fail=options&&options.error?options.error:fail;var type=options&&options.type?options.type:"post";var dataType=options&&options.dataType?options.dataType:"json";if(root.$){root.$.ajax({url:url,type:type,data:postData,dataType:dataType,success:function(res){if(typeof su==="function"){su.call(this,res)}},error:function(xhr,errType){if(typeof fail==="function"){fail.call(this,xhr,errType)}}})}else{throw new Error("doRequest: $不存在，此方法依赖于(jQuery||Zepto||Ender)")}},doAjax:function(url,postData,su,fail){this.doRequest(url,postData,function(res){if(typeof su==="function"){su.call(this,res)}},function(xhr,errType){if(typeof fail==="function"){fail.call(this,xhr,errType)}})}};var shareModel=SYST.shareModel={_cacheList:{},add:function(key,val){SYST.shareModels[key]=val},get:function(key){return SYST.shareModels[key]},remove:function(key){SYST.shareModels[key]=null;delete SYST.shareModels[key]}};var Controller=SYST.Controller=function(child){this.__Name__="Controller";this.model=undefined;this.shareModels={};this.validate={};if(child){child.__SuperName__="SYST Controller";child=SYST._extend(SYST.Controller,child);child._initialize();return child}else{return new SYST.Controller({})}};SYST.Controller.prototype={defaultHost:location.host,shareModels:{},_initialize:function(){this.init&&this.init.apply(this,arguments);this.validate=SYST.V},getModel:function(key){if(key){return this.shareModels[key]}else{return this.model}},setModel:function(key,val){if(key!==""||typeof key==="string"){this.shareModels[key]=val}else{if(typeof key==="object"){this.model=key}else{throw"setModel: 参数有误"}}},shareModel:SYST.shareModel};var Events=SYST.Events=function(obj,pobj,evt,func,type){var self=this;var type=type||"on";var evts="abort reset click dblclick tap touchstart touchmove touchend change mouseover mouseout mouseup mousedown mousemove mousewheel drag dragend dragenter dragleave dragover dragstart drop resize scroll submit select keydown keyup keypress touchstart touchend load unload blur focus contextmenu formchange forminput input invalid afterprint beforeprint beforeonload haschange message offline online pagehide pageshow popstate redo storage undo canplay canplaythrough durationchange emptied ended loadeddata loadedmetadata loadstart pause play playing progress ratechange readystatechange seeked seeking stalled suspend timeupdate volumechange waiting cut copy paste".split(/\s+/gi);if(!obj){obj=window}if(window.$||window.jQuery){for(var i=0;i<evts.length;i++){if(evts[i]===evt){if(obj.selector=="window"){if(type=="on"){$(window).off().on(evt,hoadEvent(pobj,func))}else{$(window).off(evt,hoadEvent(pobj,func))}}else{if(obj.selector=="document"||obj.selector=="html"||obj.selector=="body"){if(type=="on"){$(obj.selector).off().on(evt,hoadEvent(pobj,func))}else{$(obj.selector).off(evt,hoadEvent(pobj,func))}}else{if(type=="on"){$("body").delegate(obj.selector,evt,hoadEvent(pobj,func))}else{$("body").undelegate(obj.selector,evt,hoadEvent(pobj,func))}}}}else{continue}}}else{throw new Error("请先引入jQuery或者是zepto")}};var hoadEvent=SYST.hoadEvent=function(obj,func){var args=[],self=this;obj=obj||window;for(var i=2;i<arguments.length;i++){args.push(argments[i])}return function(e){if(e&&typeof evt==="object"){e.preventDefault();e.stopPropagation()}args.push(e);if(obj[func]){obj[func].call(obj,e,args)}else{throw new Error(func+" 函数未定义！")}}};var View=SYST.View=function(child){this.__Name__="View";this.controller=undefined;this.model=undefined;this.events={};if(child){child.__SuperName__="SYST View";child=SYST._extend(SYST.View,child);child._initialize();return child}else{return new SYST.View({})}};SYST.View.prototype={$el:{},tagPanel:"selection",_template:"",_initialize:function(){var self=this;this.el={};this.chache=[];this.els={};this.shareModels={};this.model=this.model?this.model:(this.controller?this.controller.getModel():undefined);this.init&&this.init.apply(this,arguments);if(this.render){var panel="<"+self.tagPanel+"/>";self.$el=SYST.$?SYST.$(panel):self.parseDom("",panel);self.render.apply(self,arguments)}this.parseEvent(this.events);this.autoHandleEvent()},destroy:function(){this.$el.remove()},handle:function(callback,value){var self=this;return function(e){callback.apply(self,arguments)}},handEvent:function(callback,value){var self=this,args=[];for(var i=2;i<arguments.length;i++){args.push(arguments[i])}return function(e){args.push(value);args.push(e);callback.apply(self,args)}},hoadEvent:function(obj,func){var args=[];obj=obj||this||window;for(var i=2;i<arguments.length;i++){args.push(arguments[i])}return function(e){if(e&&typeof evt==="object"){e.preventDefault();e.stopPropagation()}args.push(e);if(obj[func]){obj[func].call(obj,e,args)}else{throw new Error(func+" 函数未定义！")}}},parseEvent:function(evtObj){if(!evtObj||evtObj.length==0||evtObj==={}){return this}var evts=[],objs=[],handleFunctions=[];for(var evt in evtObj){var o=(SYST.T.trim(evt)).split(/\s+/gi);objs.push(o[1].replace(/^\$*|[\(*]|[\)*]$/gi,"").replace(/"|'/gi,'"'));evts.push(o[0].replace(/^\s*|\s*$/gi,""));handleFunctions.push(evtObj[evt])}this.evts=evts;this.objs=objs;this.handleFunctions=handleFunctions},autoHandleEvent:function(type){if(!this.evts||this.evts.length==0||this.evts.length=={}){return this}var type=type||"on";for(var i=0,l=this.evts.length;i<l;i++){if(!this.evts[i]){throw new Error("对象侦听"+this.evts[i]+"不存在")}if(!this.handleFunctions[i]){throw new Error("对象"+this+"不存在"+this.handleFunctions[i]+"方法")}if(!this.objs[i]){throw new Error("事件函数"+this.handleFunctions[i]+"不存在")}SYST.Events($(this.objs[i]),this,this.evts[i],this.handleFunctions[i],type)}return this},onEvent:function(){this.autoHandleEvent("on")},offEvent:function(){this.autoHandleEvent("off")},template:function(htmlStr,data){var compHtml,render;if(root.template){render=SYST.template.compile(htmlStr);compHtml=render(data);return compHtml}else{if(root._){compHtml=_.template(htmlStr,data)}else{compHtml=SYST.$?SYST.$(htmlStr):this.parseDom(htmlStr)}}return compHtml},parseDom:function(htmlStr,tagPanel){return SYST.T.template(htmlStr,tagPanel)},getEl:function(selector,content){var el;if(selector.indexOf("#")!==-1&&selector.indexOf("#")===0){el=document.getElementById(selector.substring(1))}else{if(selector.indexOf(".")!==-1&&selector.indexOf(".")===0){el=document.getElementsByClassName(selector.substring(1))}else{el=document.getElementsByTagName(selector.replace(/^[^a-zA-Z]*/gi,""))}}this.els.el=el;return el},getController:function(){return this.controller},getModel:function(){return this.model||this.getController().getModel()},shareModel:SYST.shareModels};SYST._template=function(htmlStr,tagPanel){var element=document.createElement(tagPanel||"div");element.innerHTML=htmlStr;return element.childNodes};var Validate=SYST.Validate=function(child){this.__Name__="Validate";if(child){child.__SuperName__="SYST Validate";child=SYST._extend(SYST.Validate,child);return child}else{return new SYST.Validate({})}};SYST.V=SYST.Validate.prototype={isEmpty:function(val){return(!val||val.length==0||val==""||val==null||typeof val=="undefined")?true:false},isSet:function(val){return(val||typeof val!="undefined")?true:false},between:function(val,min,max,flag){flag=flag||false;if(flag){return(val.length>=min&&val.length<=max)?true:false}else{return(val.length>min&&val.length<max)?true:false}},isCN:function(str,flag){if(flag){return(/^[\u4e00-\u9fa5]+$/.test(str))}else{return(/[\u4e00-\u9fa5]+/gi.test(str))}},isEmail:function(email){return/^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/gi.test(email)},isURL:function(url){return/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/i.test(url)},isTel:function(tel){return/^(\(\d{3,4}\)|\d{3,4}-)?\d{7,8}$/gi.test(tel)},isMobile:function(mobile){return/^1[3|5|8]{1}\d{9}$/.test(mobile)},isZip:function(zipCode){return/^\d{6}$/.test(zipCode)},isDateLocal:function(date){return/^(\d{4})-(\d{1,2})-(\d{1,2})$/.test(date)},isDateTime:function(dateTime){return/^(\d{4})-(\d{1,2})-(\d{1,2})\s+(\d{1,2}):(\d{1,2}):(\d{1,2})$/.test(dateTime)},isTime:function(time){return/^(\d{1,2}):(\d{1,2}):(\d{1,2})$/.test(time)},isString:function(value){return typeof value==="string"},isNumber:function(value){return typeof value==="number"},isArray:function(value){return toString.call(value)==="[object Array]"},isDate:function(value){return toString.call(value)==="[object Date]"},isObject:function(value){return value!=null&&typeof value==="object"},isFunction:function(value){return toString.call(value)==="[object Function]"},isFile:function(value){return toString.call(value)==="[object File]"},isBlob:function(value){return toString.call(value)==="[object Blob]"},isBoolean:function(value){return typeof value==="boolean"},isUndefined:function(value){return typeof value==="undefined"},isdefined:function(value){return typeof value!=="undefined"},isRegExp:function(value){return toString.call(value)==="[object RegExp]"},isWindow:function(value){return value&&value.document&&value.location&&value.alert&&value.setInterval},isElement:function(value){return !!(value&&(value.nodeName||(value.prop&&value.attr&&value.find)))}};var Tools=SYST.Tools=function(child){this.__Name__="Tools";if(child){child.__SuperName__="SYST Tools";child=SYST._extend(SYST.Tools,child);return child}else{return new SYST.Tools({})}};SYST.T=SYST.Tools.prototype={template:function(htmlStr,tagPanel){var element=document.createElement(tagPanel||"div");element.innerHTML=htmlStr;if($){$(element).html(htmlStr);return $(element)[0]}return element.childNodes},trigger:function(element,event,data,callback){if(element&&event&&""!==event){try{element[method].call(element,data,arguments);if(typeof callback==="function"){callback.call(element,data)}}catch(e){throw new Error(element+"不存在"+event+"方法 <::>")}}},params:function(name){this.params[name]=this.getParams(name);return this.params[name]},trim:function(val){return val.replace(/^\s*|\s*$/gi,"")},rtrim:function(val,commer,flag){if(commer){var re;if(!flag){re=new RegExp("^("+commer+")*|("+commer+")*$","i")}else{re=new RegExp(""+commer+"*","gi")}var ma=val.match(re)[0];return val.replace(re,"")}else{return val.replace(/^\s*|\s*$/gi,"")}},size:function(val){var count=0,key;if(SYST.V.isString(val)||SYST.V.isArray(val)){return val.length}else{if(SYST.V.isObject(val)){for(key in val){if(val.hasOwnProperty(key)){count++}}}}return count},indexOf:function(array,obj){if(array.indexOf){return array.indexOf(obj)}for(var i=0;i<array.length;i++){if(obj===array[i]){return i}}return -1},arrRemove:function(array,val){var index=this.indexOf(array,val);if(index>=0){array.splice(index,1)}return val},getArray:function(val){var strArr="";var flag=false;if(SYST.V.isString(val)){if(val.indexOf("...")>=0){flag=true;strArr=val.split("...")}else{if(val.indexOf("..")>=0){flag=false;strArr=val.split("..")}else{return false}}if(SYST.V.isEmpty(strArr[0])){strArr[0]=0}if(SYST.V.isEmpty(strArr[1])){throw new Error("结束数值必须存在 ;)");return false}var first=+strArr[0];var last=+strArr[1];var i=flag?first:first+1;var l=flag?last+1:last;var arr=[];if(first<last){for(;i<l;i++){arr.push(i)}}else{if(first==last){arr.push(first)}else{if(first>last){i=flag?first:first-1;l=flag?last-1:last;for(;i>l;i--){arr.push(i)}}}}return arr}return""},getString:function(val,commer){var strArr="";var flag=false;commer=commer||",";var firstChar="";var lastChar="";var firstCode=0;var lastCode=0;var num=0;var s="";var a=[];if(SYST.V.isString(val)){if(val.indexOf("**")>=0){flag=false;strArr=val.split("**");firstChar=strArr[0];lastChar=strArr[1];if(!isNaN(parseInt(firstChar))&&!isNaN(parseInt(lastChar))){firstCode=parseInt(firstChar);lastCode=parseInt(lastChar);if(firstChar>lastChar){for(;firstCode>lastCode-1;firstCode--){a.push(String(firstCode))}}else{if(firstCode==lastCode){a.push(String(firstCode))}else{if(firstCode<lastCode){for(;firstCode<lastCode+1;firstCode++){a.push(String(firstCode))}}}}return a.join(commer)}else{if(SYST.V.isString(firstChar)&&SYST.V.isString(lastChar)){firstCode=firstChar.toLowerCase().charCodeAt();lastCode=lastChar.toLowerCase().charCodeAt();if(firstCode>lastCode){for(;firstCode>lastCode-1;firstCode--){if(firstCode>=91&&firstCode<=96){continue}var sc=String.fromCharCode(firstCode);s+=sc}}else{if(firstCode==lastCode){s=firstChar}else{if(firstCode<lastCode){for(;firstCode<lastCode+1;firstCode++){if(firstCode>=91&&firstCode<=96){continue}var sc=String.fromCharCode(firstCode);s+=sc}}}}return s}}}else{if(val.indexOf("*")>=0){flag=true;strArr=val.split("*");firstChar=strArr[0];num=isNaN(parseInt(strArr[1]))?firstChar.charCodeAt():parseInt(strArr[1]);for(var i=0;i<num;i++){s+=firstChar}return s}else{return""}}}return""},F2C:function(str){var s="",str=str.replace(/\s*/gi,"");for(var i=0;i<str.length;i++){var c=str.charCodeAt(i);if(c==12288){s+=String.fromCharCode(32);continue}if(c>65280&&c<65375){s+=String.fromCharCode(c-65248);continue}s+=String.fromCharCode(c)}s=s.replace(/\s*/gi,"");return s.toUpperCase()},dateFm:function(n){return(n<10)?"0"+n:n},setDateFormat:function(timestamp){var date=new Date(parseInt(timestamp));return date.getFullYear()+"-"+App.dateFm(date.getMonth()+1)+"-"+App.dateFm(date.getDate())+" "+App.dateFm(date.getHours())+":"+App.dateFm(date.getMinutes())+":"+App.dateFm(date.getSeconds())},daysBetween:function(DateOne,DateTwo,callback){var OneMonth=DateOne.substring(5,DateOne.lastIndexOf("-"));var OneDay=DateOne.substring(DateOne.length,DateOne.lastIndexOf("-")+1);var OneYear=DateOne.substring(0,DateOne.indexOf("-"));var TwoMonth=DateTwo.substring(5,DateTwo.lastIndexOf("-"));var TwoDay=DateTwo.substring(DateTwo.length,DateTwo.lastIndexOf("-")+1);var TwoYear=DateTwo.substring(0,DateTwo.indexOf("-"));var CDays=((Date.parse(OneMonth+"/"+OneDay+"/"+OneYear)-Date.parse(TwoMonth+"/"+TwoDay+"/"+TwoYear))/86400000);if(callback&&typeof callback==="function"){callback(CDays)}else{return CDays}},getParams:function(name){var reg=new RegExp("(^|&)"+name+"=([^&]*)(&|$)","i");var r=window.location.search.substr(1).match(reg);if(r){return decodeURI(r[2])}return null},Cookie:function(key,value,options){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(value))||value===null||value===undefined)){options=options||{};if(value===null||value===undefined){options.expires=-1}if(typeof options.expires==="number"){var days=options.expires,t=options.expires=new Date();t.setDate(t.getDate()+days)}value=String(value);return(document.cookie=[encodeURIComponent(key),"=",options.raw?value:encodeURIComponent(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join(""))}options=value||{};var decode=options.raw?function(s){return s}:decodeURIComponent;var pairs=document.cookie.split("; ");for(var i=0,pair;pair=pairs[i]&&pairs[i].split("=");i++){if(decode(pair[0])===key){return decode(pair[1]||"")}}return null},subString:function(str,len,commer){if(!str||str.length==0){return""}if(SYST.V.isNumber(str)){str=""+str}if(!len){return str}if(len==0){return""}var commer=commer||"...";var sarr=[];var l=str.length;if(l<=len){commer=""}if(len>0){for(var i=0;i<l;i++){if(i>len-1){continue}else{sarr.push(str[i])}}}else{for(var i=l;i>=l-Math.abs(len);i--){sarr.unshift(str[i])}}return sarr.join("")+commer}};var Native=SYST.Native=function(child){this.__Name__="Native";this.isAndroid=SYST.IS_ANDROID;this.isIos=SYST.IS_IOS;this.isNative=(SYST.IS_ANDROID||SYST.IS_IOS)?true:false;if(child){child.__SuperName__="SYST Native";child=SYST._extend(SYST.Native,child);return child}else{return new SYST.Native({})}};SYST.N=SYST.Native.prototype={isAndroid:SYST.IS_ANDROID,isIos:SYST.IS_IOS,isNative:(SYST.IS_ANDROID||SYST.IS_IOS)?true:false,callNative:function(name){SYST._call(name)}};var _callindex=0,_toString=Object.prototype.toString;var _exec=function(fn){if(_toString.call(fn)=="[object Function]"){fn()}};SYST._call=function(name){var args=Array.prototype.slice.call(arguments,1);var callback="",item=null;for(var i=0,len=args.length;i<len;i++){item=args[i];if(item===undefined){item=""}if(_toString.call(item)=="[object Function]"){callback=name+"Callback"+i;root[callback]=item;console.log(root);item=callback}args[i]=item}if(SYST.IS_ANDROID){try{for(var i=0,len=args.length;i<len;i++){args[i]="'"+args[i]+"'"}eval("window.android."+name+"("+args.join(",")+")")}catch(e){console.log(e)}eval()}else{if(SYST.IS_IOS){if(args.length){args="|"+args.join("|")}_callindex++;location.href="#ios:"+name+args+"|"+_callindex}}};root.hoadEvent=window.hoadEvent=function(obj,func){var args=[],self=this;obj=obj||window;for(var i=2;i<arguments.length;i++){args.push(arguments[i])}return function(e){if(e&&typeof evt==="object"){e.preventDefault();e.stopPropagation()}args.push(e);obj[func].call(obj,e,args)}};if(typeof define==="function"){define(function(){return SYST})}else{if(typeof exports!=="undefined"){module.exports=SYST}else{SYST=root.SYST=function(){}}}root.SYST=SYST}).call(this);